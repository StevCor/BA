{% extends "one-table-template.html" %}

{% block title %}: Suchen und Ersetzen
{% endblock title %}

{% block replace_active %} class="active" {% endblock %}

{% block one_table_form %}
<form id="replace-params" action="{{ '/replace-preview' }}" method="POST">
    Bitte wählen geben Sie an, in welchen Spalten die Ersetzung vorgenommen werden soll. Kommt der gesuchte String
    mehrfach in einem Eintrag vor, werden alle Vorkommen ersetzt. Bei Eingabe eines
    leeren Strings wird der gesuchte String gelöscht.
    <div class="groups">
        <div class="item">
            <label for="column-to-search">Spalte auswählen:</label>
            <select name="column-to-search" id="column-to-search" required>
                <option value="all">Alle Spalten</option>
                {% for column in table_columns %}
                <option value="{{ column }}">{{ column }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="item">
            <label for="search-string">Suchen:</label>
            <input type="text" id="searchstring" name="searchstring" minlength="2">
        </div>
        <div class="item">
            <label for="replacement">Ersetzen durch:</label>
            <input type="text" id="replacement" name="replacement">
        </div>
        <input type="hidden" id="engine-no" name="engine-no" value="{{ engine_no }}">
        <input type="hidden" id="table-name" name="table-name" value="{{ table_name }}">
        <div class="item">
            <input type="submit" id="preview" value="Vorschau">
        </div>
    </div>

</form>
{% endblock one_table_form %}

{% block more_js %}
<script>
    function showWarnings() {
        if (document.forms['replace-params'].replacement.value === "") {
            if (confirm("Sind Sie sicher, dass Sie den gesuchten (Teil-)Wert löschen wollen?") == true) {
                return true;
            } else {
                return false;
            }
        } else if (document.forms['replace-params'].replacement.value === document.forms['replace-params'].searchstring.value) {
            alert("Der zu ersetzende und der neue Wert sind gleich. Daher werden keine Änderungen vorgenommen.")
            return false
        }
        return true;
    }
    let previewButton = document.getElementById('preview');
    previewButton.addEventListener('click', function () {
        return showWarnings();
    });
</script>
{% endblock more_js %}