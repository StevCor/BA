{% extends "one-table-preview-template.html"%}

{% block title %}
: Auswahl für Vereinheitlichen
{% endblock title %}

{% block unify_active %} class="active" {% endblock unify_active %}

{% block preview_content %}
<h4>Alle Werte des Attributs {{ column_to_unify }}</h4>
Bitte wählen Sie die Werte aus, die ersetzt werden sollen.
<form action="{{ '/unify-preview' }}" method="POST">
    <div class="groups">
        <div class="item">
            <label for="replacement">Ausgewählte Werte ersetzen durch:</label>
            <input type="text" id="replacement" name="replacement">
        </div>
        <div class="item">
            <input type="submit" id="preview" value="Vorschau">
        </div>
    </div>
    <div id="table">
        <table id="selection">
            <thead>
                <tr>
                    <th></th>
                    <th>{{ column_to_unify }}</th>
                    <th>Anzahl Einträge</th>
                </tr>
            </thead>
            <tbody>
                {# Zähler stammt von
                https://stackoverflow.com/questions/7537439/how-to-increment-a-variable-on-a-for-loop-in-jinja-template
                #}
                {% set count = [] %}
                {% for row in data %}
                {% set __ = count.append(1) %}
                <tr>
                    {% for item in row %}
                    {% if item == row[0] %}
                    <td><input type="checkbox" name="{{ count|length }}" value="{{ item }}"></td>
                    <td>{{ item }}</td>
                    {% else %}
                    <td>{{ item }}</td>
                    {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <input type="hidden" id="column-to-unify" name="column-to-unify" value="{{ column_to_unify }}">
    <input type="hidden" id="table-name" name="table-name" value="{{ table_name }}">

</form>
{% endblock preview_content %}

{% block more_js %}

<script src="{{url_for('static', filename='isEmpty.js')}}"></script>
<script>
    // Button zur Anzeige der Vorschau
    let previewButton = document.getElementById('preview');
    // String, durch den die ausgewählten Werte ersetzt werden sollen
    let replacementString = document.getElementById('replacement');
    // Abfrage einer Bestätigung, falls der mit Klick auf den Vorschau-Button abgesendete Ersatzstring leer ist oder 'None' bzw. 'NULL' lautet
    previewButton.addEventListener('click', function () {
        return isEmpty(replacementString);
    })
</script>

{% endblock more_js %}