<!DOCTYPE html>
<html lang="de">

<head>
    <title>SQL-Datenbanken{% block title %}{% endblock title %}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
</head>

<body>
    <div class="two-tables">
        <nav class="navtop">
            <div>
                <h1>Willkommen, {{user_name}}!</h1>
                <div class="connection">
                    <h3>Verbunden mit Datenbank {{ db_name_1 }} ({{ db_dialects[0] }}), Tabelle {{ table_name_1 }} und
                        Datenbank
                        {{
                        db_name_2 }} ({{ db_dialects[1]}}), Tabelle {{ table_name_2 }}</h3>
                    <a href="{{ url_for('disconnect_from_db', engine_no = 3) }}"><button
                            id="disconnect">Datenbankverbindungen
                            trennen</button></a>
                </div>
                <a href="{{ url_for('logout') }}"><button>Logout</button></a>
            </div>
        </nav>
        <div class="links">
            <button id="back">Zurück</button>
            <div class="tab">
                <a href="{{ url_for('compare_two_tables') }}" {% block compare_active %}{% endblock compare_active
                    %}>Tabellen
                    vergleichen</a>
                <a href="{{ url_for('merge_tables') }}" {% block merge_active %}{% endblock merge_active %}>Tabellen
                    verbinden</a>
            </div>
        </div>
        {% include 'message.html' %}
        <div class="selection">
            <form {% block form_action %}{% endblock form_action %} method="POST">
                <label for="target-table">Zieltabelle des Joins:</label>
                <select id="target-table" name="target-table" required>
                    <option value="table_1" name="target-table" selected>{{ db_name_1 + '.' + table_name_1 }}
                    </option>
                    <option value="table_2" name="target-table">{{ db_name_2 + '.' + table_name_2 }}</option>
                </select>
                <label for="attribute-selection">Verbinden über:</label>
                <select name="attribute-selection" id="attribute-selection" required>
                    {% for key, val in comp_by_code|dictsort %}
                    {% if key == 1 %}
                    <optgroup label="vollständig kompatibel">
                        {% elif key == 2 %}
                    <optgroup label="ggf. uneindeutige Werte">
                        {% elif key == 3 %}
                    <optgroup label="ggf. Typkonversion nötig">
                        {% elif key == 4 %}
                    <optgroup label="Typkonversion nötig">
                        {% elif key == 5 %}
                    <optgroup label="ggf. Typkonversion nötig und ggf. uneindeutige Werte">
                        {% elif key == 6 %}
                    <optgroup label="Typkonversion nötig und ggf. uneindeutige Werte">
                        {% endif %}
                        {% for value in comp_by_code[key] %}
                        <option value="{{ value[0] }}, {{ value[1] }}" name="{{ value[0] }}, {{ value[1] }}">{{
                            db_name_1 + '.' + value[0]
                            }}, {{ db_name_2 +
                            '.' + value[1] }}
                        </option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
                <div class="cast-selection">
                    Typkonversion erzwingen:
                    <input type="radio" id="none" name="cast" value=0 checked required>
                    <label for="none">Keine</label>
                    <input type="radio" id="attribute1" name="cast" value=1 required>
                    <label for="attribute1">Für {{ db_name_1 }}.{{ table_name_1 }}</label>
                    <input type="radio" id="attribute2" name="cast" value=2 required>
                    <label for="attribute2">Für {{ db_name_2 }}.{{ table_name_2 }}</label>
                </div>

                {% block additional_params %}{% endblock additional_params %}

            </form>
        </div>
        <div id="tables">
            <div id="table1"></div>
            <div id="table2"></div>
        </div>
    </div>
    <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <script src="{{url_for('static', filename='showTable.js')}}"></script>
    <script src="{{url_for('static', filename='confirmBack.js')}}"></script>
    <script>
        var columns1 = {{ table_columns_1 | tojson | safe }};
        var data1 = {{ data_1 | tojson | safe }};
        showTable(columns1, data1, 'table1');

        var columns2 = {{ table_columns_2 | tojson | safe }};
        var data2 = {{ data_2 | tojson | safe }};
        showTable(columns2, data2, 'table2');

        const backButton = document.getElementById('back')
        backButton.addEventListener('click', function () {
            confirmBack();
        });

        const disconnectButton = document.getElementById('disconnect');
        disconnectButton.addEventListener('click', function () {
            return confirm('Sind Sie sicher, dass Sie die Datenbankverbindungen trennen wollen? Sie kehren dann zur Anmeldeseite zurück.');
        });
    </script>

    {% block more_js %}
    {% endblock more_js %}

</body>

</html>